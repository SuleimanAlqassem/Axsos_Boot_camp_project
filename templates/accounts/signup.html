{% extends 'base.html' %}
{% block title %}Sign Up{% endblock %}

{% block content %}
<div class="form-container">
    <h2 class="mb-4 text-center">Create an Account</h2>

    <form method="POST" id="signup-form">
        {% csrf_token %}

        <!-- Username field -->
        <div class="row mb-3 align-items-center">
            <label for="id_username" class="col-sm-4 col-form-label">Username</label>
            <div class="col-sm-8">
                {{ form.username }}
                <small id="username-warning" class="text-danger"></small>
            </div>
        </div>

        <!-- Email field -->
        <div class="row mb-3 align-items-center">
            <label for="id_email" class="col-sm-4 col-form-label">Email</label>
            <div class="col-sm-8">
                {{ form.email}}
                <small id="email-warning" class="text-danger"></small>
            </div>
        </div>

        <!-- Password1 field -->
        <div class="row mb-3 align-items-center">
            <label for="id_password1" class="col-sm-4 col-form-label">Password</label>
            <div class="col-sm-8">
                {{ form.password1 }}
                <small id="password1-warning" class="text-danger"></small>
            </div>
        </div>

        <!-- Password2 field -->
        <div class="row mb-3 align-items-center">
            <label for="id_password2" class="col-sm-4 col-form-label">Confirm Password</label>
            <div class="col-sm-8">
                {{ form.password2 }}
                <small id="password2-warning" class="text-danger"></small>
            </div>
        </div>

        <button type="submit" class="btn btn-primary w-100">Sign Up</button>
    </form>
</div>


<script>
function validateSignup() {
  const username = document.getElementById('id_username').value;
  const email = document.getElementById('id_email').value;
  const password1 = document.getElementById('id_password1').value;
  const password2 = document.getElementById('id_password2').value;

  fetch(`/accounts/ajax/validate-signup/?username=${username}&email=${email}&password1=${password1}&password2=${password2}`)
    .then(response => response.json())
    .then(data => {
      document.getElementById('username-warning').textContent = data.username_exists ? 'Username already taken' : '';
      document.getElementById('email-warning').textContent = data.email_exists ? 'Email already in use' : '';
      document.getElementById('password1-warning').textContent = data.password_strength ? '' : 'Password too weak';
      document.getElementById('password2-warning').textContent = data.password_match ? '' : 'Passwords do not match';
    });
}

// إضافة حدث blur لكل حقل
document.querySelectorAll('#id_username, #id_email, #id_password1, #id_password2').forEach(input => {
  input.addEventListener('blur', validateSignup);
});
</script>

{% endblock %}
